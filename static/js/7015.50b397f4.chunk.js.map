{"version":3,"file":"static/js/7015.50b397f4.chunk.js","mappings":"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","sources":["state/stake/hooks.tsx","pages/Pool/v2.tsx"],"sourcesContent":["import { Interface } from '@ethersproject/abi'\nimport StakingRewardsJSON from '@uniswap/liquidity-staker/build/StakingRewards.json'\nimport { ChainId, CurrencyAmount, Token } from '@uniswap/sdk-core'\nimport { Pair } from '@uniswap/v2-sdk'\nimport { useWeb3React } from '@web3-react/core'\nimport useCurrentBlockTimestamp from 'hooks/useCurrentBlockTimestamp'\nimport JSBI from 'jsbi'\nimport { NEVER_RELOAD, useMultipleContractSingleData } from 'lib/hooks/multicall'\nimport { useMemo } from 'react'\n\nimport { DAI, UNI, USDC_MAINNET, USDT, WBTC, WRAPPED_NATIVE_CURRENCY } from '../../constants/tokens'\n\nconst STAKING_REWARDS_INTERFACE = new Interface(StakingRewardsJSON.abi)\n\nexport const STAKING_GENESIS = 1600387200\n\nconst STAKING_REWARDS_INFO: {\n  [chainId: number]: {\n    tokens: [Token, Token]\n    stakingRewardAddress: string\n  }[]\n} = {\n  1: [\n    {\n      tokens: [WRAPPED_NATIVE_CURRENCY[ChainId.MAINNET] as Token, DAI],\n      stakingRewardAddress: '0xa1484C3aa22a66C62b77E0AE78E15258bd0cB711',\n    },\n    {\n      tokens: [WRAPPED_NATIVE_CURRENCY[ChainId.MAINNET] as Token, USDC_MAINNET],\n      stakingRewardAddress: '0x7FBa4B8Dc5E7616e59622806932DBea72537A56b',\n    },\n    {\n      tokens: [WRAPPED_NATIVE_CURRENCY[ChainId.MAINNET] as Token, USDT],\n      stakingRewardAddress: '0x6C3e4cb2E96B01F4b866965A91ed4437839A121a',\n    },\n    {\n      tokens: [WRAPPED_NATIVE_CURRENCY[ChainId.MAINNET] as Token, WBTC],\n      stakingRewardAddress: '0xCA35e32e7926b96A9988f61d510E038108d8068e',\n    },\n  ],\n}\n\ninterface StakingInfo {\n  // the address of the reward contract\n  stakingRewardAddress: string\n  // the tokens involved in this pair\n  tokens: [Token, Token]\n  // the amount of token currently staked, or undefined if no account\n  stakedAmount: CurrencyAmount<Token>\n  // the amount of reward token earned by the active account, or undefined if no account\n  earnedAmount: CurrencyAmount<Token>\n  // the total amount of token staked in the contract\n  totalStakedAmount: CurrencyAmount<Token>\n  // the amount of token distributed per second to all LPs, constant\n  totalRewardRate: CurrencyAmount<Token>\n  // the current amount of token distributed to the active account per second.\n  // equivalent to percent of total supply * reward rate\n  rewardRate: CurrencyAmount<Token>\n  // when the period ends\n  periodFinish?: Date\n  // if pool is active\n  active: boolean\n  // calculates a hypothetical amount of token distributed to the active account per second.\n  getHypotheticalRewardRate: (\n    stakedAmount: CurrencyAmount<Token>,\n    totalStakedAmount: CurrencyAmount<Token>,\n    totalRewardRate: CurrencyAmount<Token>\n  ) => CurrencyAmount<Token>\n}\n\n// gets the staking info from the network for the active chain id\nexport function useStakingInfo(pairToFilterBy?: Pair | null): StakingInfo[] {\n  const { chainId, account } = useWeb3React()\n\n  // detect if staking is ended\n  const currentBlockTimestamp = useCurrentBlockTimestamp()\n\n  const info = useMemo(\n    () =>\n      chainId\n        ? STAKING_REWARDS_INFO[chainId]?.filter((stakingRewardInfo) =>\n            pairToFilterBy === undefined\n              ? true\n              : pairToFilterBy === null\n              ? false\n              : pairToFilterBy.involvesToken(stakingRewardInfo.tokens[0]) &&\n                pairToFilterBy.involvesToken(stakingRewardInfo.tokens[1])\n          ) ?? []\n        : [],\n    [chainId, pairToFilterBy]\n  )\n\n  const uni = chainId ? UNI[chainId] : undefined\n\n  const rewardsAddresses = useMemo(() => info.map(({ stakingRewardAddress }) => stakingRewardAddress), [info])\n\n  const accountArg = useMemo(() => [account ?? undefined], [account])\n\n  // get all the info from the staking rewards contracts\n  const balances = useMultipleContractSingleData(rewardsAddresses, STAKING_REWARDS_INTERFACE, 'balanceOf', accountArg)\n  const earnedAmounts = useMultipleContractSingleData(rewardsAddresses, STAKING_REWARDS_INTERFACE, 'earned', accountArg)\n  const totalSupplies = useMultipleContractSingleData(rewardsAddresses, STAKING_REWARDS_INTERFACE, 'totalSupply')\n\n  // tokens per second, constants\n  const rewardRates = useMultipleContractSingleData(\n    rewardsAddresses,\n    STAKING_REWARDS_INTERFACE,\n    'rewardRate',\n    undefined,\n    NEVER_RELOAD\n  )\n  const periodFinishes = useMultipleContractSingleData(\n    rewardsAddresses,\n    STAKING_REWARDS_INTERFACE,\n    'periodFinish',\n    undefined,\n    NEVER_RELOAD\n  )\n\n  return useMemo(() => {\n    if (!chainId || !uni) return []\n\n    return rewardsAddresses.reduce<StakingInfo[]>((memo, rewardsAddress, index) => {\n      // these two are dependent on account\n      const balanceState = balances[index]\n      const earnedAmountState = earnedAmounts[index]\n\n      // these get fetched regardless of account\n      const totalSupplyState = totalSupplies[index]\n      const rewardRateState = rewardRates[index]\n      const periodFinishState = periodFinishes[index]\n\n      if (\n        // these may be undefined if not logged in\n        !balanceState?.loading &&\n        !earnedAmountState?.loading &&\n        // always need these\n        totalSupplyState &&\n        !totalSupplyState.loading &&\n        rewardRateState &&\n        !rewardRateState.loading &&\n        periodFinishState &&\n        !periodFinishState.loading\n      ) {\n        if (\n          balanceState?.error ||\n          earnedAmountState?.error ||\n          totalSupplyState.error ||\n          rewardRateState.error ||\n          periodFinishState.error\n        ) {\n          console.error('Failed to load staking rewards info')\n          return memo\n        }\n\n        // get the LP token\n        const tokens = info[index].tokens\n        const dummyPair = new Pair(\n          CurrencyAmount.fromRawAmount(tokens[0], '0'),\n          CurrencyAmount.fromRawAmount(tokens[1], '0')\n        )\n\n        // check for account, if no account set to 0\n\n        const stakedAmount = CurrencyAmount.fromRawAmount(\n          dummyPair.liquidityToken,\n          JSBI.BigInt(balanceState?.result?.[0] ?? 0)\n        )\n        const totalStakedAmount = CurrencyAmount.fromRawAmount(\n          dummyPair.liquidityToken,\n          JSBI.BigInt(totalSupplyState.result?.[0])\n        )\n        const totalRewardRate = CurrencyAmount.fromRawAmount(uni, JSBI.BigInt(rewardRateState.result?.[0]))\n\n        const getHypotheticalRewardRate = (\n          stakedAmount: CurrencyAmount<Token>,\n          totalStakedAmount: CurrencyAmount<Token>,\n          totalRewardRate: CurrencyAmount<Token>\n        ): CurrencyAmount<Token> => {\n          return CurrencyAmount.fromRawAmount(\n            uni,\n            JSBI.greaterThan(totalStakedAmount.quotient, JSBI.BigInt(0))\n              ? JSBI.divide(JSBI.multiply(totalRewardRate.quotient, stakedAmount.quotient), totalStakedAmount.quotient)\n              : JSBI.BigInt(0)\n          )\n        }\n\n        const individualRewardRate = getHypotheticalRewardRate(stakedAmount, totalStakedAmount, totalRewardRate)\n\n        const periodFinishSeconds = periodFinishState.result?.[0]?.toNumber()\n        const periodFinishMs = periodFinishSeconds * 1000\n\n        // compare period end timestamp vs current block timestamp (in seconds)\n        const active =\n          periodFinishSeconds && currentBlockTimestamp ? periodFinishSeconds > currentBlockTimestamp.toNumber() : true\n\n        memo.push({\n          stakingRewardAddress: rewardsAddress,\n          tokens: info[index].tokens,\n          periodFinish: periodFinishMs > 0 ? new Date(periodFinishMs) : undefined,\n          earnedAmount: CurrencyAmount.fromRawAmount(uni, JSBI.BigInt(earnedAmountState?.result?.[0] ?? 0)),\n          rewardRate: individualRewardRate,\n          totalRewardRate,\n          stakedAmount,\n          totalStakedAmount,\n          getHypotheticalRewardRate,\n          active,\n        })\n      }\n      return memo\n    }, [])\n  }, [\n    balances,\n    chainId,\n    currentBlockTimestamp,\n    earnedAmounts,\n    info,\n    periodFinishes,\n    rewardRates,\n    rewardsAddresses,\n    totalSupplies,\n    uni,\n  ])\n}\n","import { Trans } from '@lingui/macro'\nimport { InterfacePageName } from '@uniswap/analytics-events'\nimport { Pair } from '@uniswap/v2-sdk'\nimport { useWeb3React } from '@web3-react/core'\nimport { Trace } from 'analytics'\nimport { V2Unsupported } from 'components/V2Unsupported'\nimport { useNetworkSupportsV2 } from 'hooks/useNetworkSupportsV2'\nimport JSBI from 'jsbi'\nimport { useMemo } from 'react'\nimport { ChevronsRight } from 'react-feather'\nimport { Link } from 'react-router-dom'\nimport { Text } from 'rebass'\nimport styled, { useTheme } from 'styled-components'\nimport { ExternalLink, HideSmall, ThemedText } from 'theme/components'\n\nimport { ButtonOutlined, ButtonPrimary, ButtonSecondary } from '../../components/Button'\nimport Card from '../../components/Card'\nimport { AutoColumn } from '../../components/Column'\nimport { CardBGImage, CardNoise, CardSection, DataCard } from '../../components/earn/styled'\nimport FullPositionCard from '../../components/PositionCard'\nimport { RowBetween, RowFixed } from '../../components/Row'\nimport { Dots } from '../../components/swap/styled'\nimport { SwitchLocaleLink } from '../../components/SwitchLocaleLink'\nimport { BIG_INT_ZERO } from '../../constants/misc'\nimport { useV2Pairs } from '../../hooks/useV2Pairs'\nimport { useTokenBalancesWithLoadingIndicator } from '../../state/connection/hooks'\nimport { useStakingInfo } from '../../state/stake/hooks'\nimport { toV2LiquidityToken, useTrackedTokenPairs } from '../../state/user/hooks'\n\nconst PageWrapper = styled(AutoColumn)`\n  max-width: 640px;\n  width: 100%;\n\n  ${({ theme }) => theme.deprecated_mediaWidth.deprecated_upToSmall`\n    padding: 0px 8px;\n  `};\n`\n\nconst LPFeeExplainer = styled(DataCard)`\n  background: radial-gradient(76.02% 75.41% at 1.84% 0%, #27ae60 0%, #000000 100%);\n  margin: 0 0 16px 0;\n  overflow: hidden;\n`\n\nconst TitleRow = styled(RowBetween)`\n  ${({ theme }) => theme.deprecated_mediaWidth.deprecated_upToSmall`\n    flex-wrap: wrap;\n    gap: 12px;\n    width: 100%;\n    flex-direction: column-reverse;\n  `};\n`\n\nconst ButtonRow = styled(RowFixed)`\n  gap: 8px;\n  ${({ theme }) => theme.deprecated_mediaWidth.deprecated_upToSmall`\n    width: 100%;\n    flex-direction: row-reverse;\n    justify-content: space-between;\n  `};\n`\n\nconst ResponsiveButtonPrimary = styled(ButtonPrimary)`\n  height: 40px;\n  width: fit-content;\n  border-radius: 12px;\n  ${({ theme }) => theme.deprecated_mediaWidth.deprecated_upToSmall`\n    width: 48%;\n  `};\n`\n\nconst ResponsiveButtonSecondary = styled(ButtonSecondary)`\n  height: 40px;\n  width: fit-content;\n  ${({ theme }) => theme.deprecated_mediaWidth.deprecated_upToSmall`\n    width: 48%;\n  `};\n`\n\nconst EmptyProposals = styled.div`\n  border: 1px solid ${({ theme }) => theme.neutral2};\n  padding: 16px 12px;\n  border-radius: 12px;\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n`\n\nexport default function Pool() {\n  const theme = useTheme()\n  const { account } = useWeb3React()\n  const networkSupportsV2 = useNetworkSupportsV2()\n\n  // fetch the user's balances of all tracked V2 LP tokens\n  let trackedTokenPairs = useTrackedTokenPairs()\n  if (!networkSupportsV2) trackedTokenPairs = []\n  const tokenPairsWithLiquidityTokens = useMemo(\n    () => trackedTokenPairs.map((tokens) => ({ liquidityToken: toV2LiquidityToken(tokens), tokens })),\n    [trackedTokenPairs]\n  )\n  const liquidityTokens = useMemo(\n    () => tokenPairsWithLiquidityTokens.map((tpwlt) => tpwlt.liquidityToken),\n    [tokenPairsWithLiquidityTokens]\n  )\n  const [v2PairsBalances, fetchingV2PairBalances] = useTokenBalancesWithLoadingIndicator(\n    account ?? undefined,\n    liquidityTokens\n  )\n\n  // fetch the reserves for all V2 pools in which the user has a balance\n  const liquidityTokensWithBalances = useMemo(\n    () =>\n      tokenPairsWithLiquidityTokens.filter(({ liquidityToken }) =>\n        v2PairsBalances[liquidityToken.address]?.greaterThan('0')\n      ),\n    [tokenPairsWithLiquidityTokens, v2PairsBalances]\n  )\n\n  const v2Pairs = useV2Pairs(liquidityTokensWithBalances.map(({ tokens }) => tokens))\n  const v2IsLoading =\n    fetchingV2PairBalances || v2Pairs?.length < liquidityTokensWithBalances.length || v2Pairs?.some((V2Pair) => !V2Pair)\n\n  const allV2PairsWithLiquidity = v2Pairs.map(([, pair]) => pair).filter((v2Pair): v2Pair is Pair => Boolean(v2Pair))\n\n  // show liquidity even if its deposited in rewards contract\n  const stakingInfo = useStakingInfo()\n  const stakingInfosWithBalance = stakingInfo?.filter((pool) =>\n    JSBI.greaterThan(pool.stakedAmount.quotient, BIG_INT_ZERO)\n  )\n  const stakingPairs = useV2Pairs(stakingInfosWithBalance?.map((stakingInfo) => stakingInfo.tokens))\n\n  // remove any pairs that also are included in pairs with stake in mining pool\n  const v2PairsWithoutStakedAmount = allV2PairsWithLiquidity.filter((v2Pair) => {\n    return (\n      stakingPairs\n        ?.map((stakingPair) => stakingPair[1])\n        .filter((stakingPair) => stakingPair?.liquidityToken.address === v2Pair.liquidityToken.address).length === 0\n    )\n  })\n\n  return (\n    <Trace page={InterfacePageName.POOL_PAGE} shouldLogImpression>\n      <>\n        <PageWrapper>\n          <LPFeeExplainer>\n            <CardBGImage />\n            <CardNoise />\n            <CardSection>\n              <AutoColumn gap=\"md\">\n                <RowBetween>\n                  <ThemedText.DeprecatedWhite fontWeight={535}>\n                    <Trans>Liquidity provider rewards</Trans>\n                  </ThemedText.DeprecatedWhite>\n                </RowBetween>\n                <RowBetween>\n                  <ThemedText.DeprecatedWhite fontSize={14}>\n                    <Trans>\n                      Liquidity providers earn a 0.3% fee on all trades proportional to their share of the pool. Fees\n                      are added to the pool, accrue in real time and can be claimed by withdrawing your liquidity.\n                    </Trans>\n                  </ThemedText.DeprecatedWhite>\n                </RowBetween>\n                <ExternalLink\n                  style={{ color: theme.white, textDecoration: 'underline' }}\n                  target=\"_blank\"\n                  href=\"https://docs.uniswap.org/contracts/v2/concepts/core-concepts/pools\"\n                >\n                  <ThemedText.DeprecatedWhite fontSize={14}>\n                    <Trans>Read more about providing liquidity</Trans>\n                  </ThemedText.DeprecatedWhite>\n                </ExternalLink>\n              </AutoColumn>\n            </CardSection>\n            <CardBGImage />\n            <CardNoise />\n          </LPFeeExplainer>\n\n          {!networkSupportsV2 ? (\n            <V2Unsupported />\n          ) : (\n            <AutoColumn gap=\"lg\" justify=\"center\">\n              <AutoColumn gap=\"md\" style={{ width: '100%' }}>\n                <TitleRow style={{ marginTop: '1rem' }} padding=\"0\">\n                  <HideSmall>\n                    <ThemedText.DeprecatedMediumHeader style={{ marginTop: '0.5rem', justifySelf: 'flex-start' }}>\n                      <Trans>Your V2 liquidity</Trans>\n                    </ThemedText.DeprecatedMediumHeader>\n                  </HideSmall>\n                  <ButtonRow>\n                    <ResponsiveButtonSecondary as={Link} padding=\"6px 8px\" to=\"/add/v2/ETH\">\n                      <Trans>Create a pair</Trans>\n                    </ResponsiveButtonSecondary>\n                    <ResponsiveButtonPrimary id=\"find-pool-button\" as={Link} to=\"/pools/v2/find\" padding=\"6px 8px\">\n                      <Text fontWeight={535} fontSize={16}>\n                        <Trans>Import pool</Trans>\n                      </Text>\n                    </ResponsiveButtonPrimary>\n                    <ResponsiveButtonPrimary id=\"join-pool-button\" as={Link} to=\"/add/v2/ETH\" padding=\"6px 8px\">\n                      <Text fontWeight={535} fontSize={16}>\n                        <Trans>Add V2 liquidity</Trans>\n                      </Text>\n                    </ResponsiveButtonPrimary>\n                  </ButtonRow>\n                </TitleRow>\n\n                {!account ? (\n                  <Card padding=\"40px\">\n                    <ThemedText.DeprecatedBody color={theme.neutral3} textAlign=\"center\">\n                      <Trans>Connect to a wallet to view your liquidity.</Trans>\n                    </ThemedText.DeprecatedBody>\n                  </Card>\n                ) : v2IsLoading ? (\n                  <EmptyProposals>\n                    <ThemedText.DeprecatedBody color={theme.neutral3} textAlign=\"center\">\n                      <Dots>\n                        <Trans>Loading</Trans>\n                      </Dots>\n                    </ThemedText.DeprecatedBody>\n                  </EmptyProposals>\n                ) : allV2PairsWithLiquidity?.length > 0 || stakingPairs?.length > 0 ? (\n                  <>\n                    <ButtonSecondary>\n                      <RowBetween>\n                        <Trans>\n                          <ExternalLink href={'https://v2.info.uniswap.org/account/' + account}>\n                            Account analytics and accrued fees\n                          </ExternalLink>\n                          <span> â†— </span>\n                        </Trans>\n                      </RowBetween>\n                    </ButtonSecondary>\n                    {v2PairsWithoutStakedAmount.map((v2Pair) => (\n                      <FullPositionCard key={v2Pair.liquidityToken.address} pair={v2Pair} />\n                    ))}\n                    {stakingPairs.map(\n                      (stakingPair, i) =>\n                        stakingPair[1] && ( // skip pairs that arent loaded\n                          <FullPositionCard\n                            key={stakingInfosWithBalance[i].stakingRewardAddress}\n                            pair={stakingPair[1]}\n                            stakedBalance={stakingInfosWithBalance[i].stakedAmount}\n                          />\n                        )\n                    )}\n                    <RowFixed justify=\"center\" style={{ width: '100%' }}>\n                      <ButtonOutlined\n                        as={Link}\n                        to=\"/migrate/v2\"\n                        id=\"import-pool-link\"\n                        style={{\n                          padding: '8px 16px',\n                          margin: '0 4px',\n                          borderRadius: '12px',\n                          width: 'fit-content',\n                          fontSize: '14px',\n                        }}\n                      >\n                        <ChevronsRight size={16} style={{ marginRight: '8px' }} />\n                        <Trans>Migrate liquidity to V3</Trans>\n                      </ButtonOutlined>\n                    </RowFixed>\n                  </>\n                ) : (\n                  <EmptyProposals>\n                    <ThemedText.DeprecatedBody color={theme.neutral3} textAlign=\"center\">\n                      <Trans>No liquidity found.</Trans>\n                    </ThemedText.DeprecatedBody>\n                  </EmptyProposals>\n                )}\n              </AutoColumn>\n            </AutoColumn>\n          )}\n        </PageWrapper>\n        <SwitchLocaleLink />\n      </>\n    </Trace>\n  )\n}\n"],"names":["STAKING_REWARDS_INTERFACE","Interface","StakingRewardsJSON","STAKING_REWARDS_INFO","tokens","WRAPPED_NATIVE_CURRENCY","ChainId","MAINNET","DAI","stakingRewardAddress","USDC_MAINNET","USDT","WBTC","PageWrapper","styled","AutoColumn","theme","deprecated_mediaWidth","deprecated_upToSmall","LPFeeExplainer","DataCard","TitleRow","RowBetween","ButtonRow","RowFixed","ResponsiveButtonPrimary","ButtonPrimary","ResponsiveButtonSecondary","ButtonSecondary","EmptyProposals","div","neutral2","Pool","useTheme","account","useWeb3React","networkSupportsV2","useNetworkSupportsV2","trackedTokenPairs","useTrackedTokenPairs","tokenPairsWithLiquidityTokens","useMemo","map","liquidityToken","toV2LiquidityToken","liquidityTokens","tpwlt","v2PairsBalances","fetchingV2PairBalances","useTokenBalancesWithLoadingIndicator","undefined","liquidityTokensWithBalances","filter","address","greaterThan","v2Pairs","useV2Pairs","v2IsLoading","length","some","V2Pair","allV2PairsWithLiquidity","pair","v2Pair","Boolean","stakingInfo","pairToFilterBy","chainId","currentBlockTimestamp","useCurrentBlockTimestamp","info","stakingRewardInfo","involvesToken","uni","UNI","rewardsAddresses","accountArg","balances","useMultipleContractSingleData","earnedAmounts","totalSupplies","rewardRates","NEVER_RELOAD","periodFinishes","reduce","memo","rewardsAddress","index","balanceState","earnedAmountState","totalSupplyState","rewardRateState","periodFinishState","loading","error","console","dummyPair","Pair","CurrencyAmount","fromRawAmount","stakedAmount","JSBI","result","totalStakedAmount","totalRewardRate","getHypotheticalRewardRate","quotient","individualRewardRate","periodFinishSeconds","toNumber","periodFinishMs","active","push","periodFinish","Date","earnedAmount","rewardRate","useStakingInfo","stakingInfosWithBalance","pool","BIG_INT_ZERO","stakingPairs","v2PairsWithoutStakedAmount","stakingPair","Trace","page","InterfacePageName","POOL_PAGE","shouldLogImpression","CardBGImage","CardNoise","CardSection","gap","ThemedText","DeprecatedWhite","fontWeight","fontSize","ExternalLink","style","color","white","textDecoration","target","href","justify","width","marginTop","padding","HideSmall","DeprecatedMediumHeader","justifySelf","as","Link","to","id","Text","DeprecatedBody","neutral3","textAlign","Dots","span","FullPositionCard","i","stakedBalance","ButtonOutlined","margin","borderRadius","ChevronsRight","size","marginRight","Card","V2Unsupported","SwitchLocaleLink"],"sourceRoot":""}